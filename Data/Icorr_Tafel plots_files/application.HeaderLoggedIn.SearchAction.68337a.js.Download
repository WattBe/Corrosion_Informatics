(window.wjp=window.wjp||[]).push([[36],{6492:function(e,t,s){"use strict";s.r(t);var i=s(2),n=s(519),r=s(86),a=s.n(r),h=s(4),l=s(8),c=s.n(l),u=s(1),d=s(62),o=s(32),j=s(16),g=(s(6647),s(0));const O=new c.a("header-search-action"),b={query:"",wasPropsQuerySavedOnState:!1,hasUserTyped:!1,items:[],isLoading:!1,highlightedIndex:null};class p extends h.Component{constructor(...e){super(...e),this.state=b,this.inputValueChange=e=>{const{url:t,viewId:s}=this.props,i={query:e,viewId:s};this.state.isLoading&&this.fetchRequest.cancel(),this.fetchRequest=Object(o.e)(Object(j.default)(t,{query:i})),this.setState({query:e,isLoading:!0}),this.fetchRequest.promise.then(e=>{this.setState({isLoading:!1}),e.success&&this.setState({items:e.result})}).catch(({isCanceled:e})=>{e||this.setState({items:[],isLoading:!1,highlightedIndex:null})})},this.handleInputValueChange=a()(this.inputValueChange,200)}static getDerivedStateFromProps(e,t){var s;return null!==(s=e.initialQueryRef)&&void 0!==s&&s.current&&!t.wasPropsQuerySavedOnState?Object(i.a)(Object(i.a)({},t),{},{query:e.initialQueryRef.current,wasPropsQuerySavedOnState:!0}):t}getCurrentlySelectedOnEnter(){const{items:e,highlightedIndex:t}=this.state;return null!==t&&e.length>t?e[this.state.highlightedIndex]:null}handleInputKeyDown(e){if("Enter"===e.key&&e.target.value){e.persist(),e.stopPropagation(),e.preventDefault();const t=this.getCurrentlySelectedOnEnter();if(t&&t.url)return void(window.location.href=t.url);Promise.resolve().then(()=>{e.target.form.submit()})}}getListHeader(){const{items:e}=this.state;return e.length>0?[Object(g.jsx)(u.Text,Object(i.a)(Object(i.a)({},O("head")),{},{children:"Researchers"}),"heading"),Object(g.jsx)("span",Object(i.a)({},O("divider")),"divider")]:null}getListFooter(){const{formUrl:e,viewId:t}=this.props,{items:s,query:n}=this.state;if(s.length>0){const s=`${e}?origin=ac&headerSearchViewId=${t}&query=${n}&type=researcher`;return[Object(g.jsx)("span",Object(i.a)({},O("divider")),"divider"),Object(g.jsxs)(u.Link,Object(i.a)(Object(i.a)({},O("more")),{},{theme:"bare",color:"blue",href:s,children:["All results for ",Object(g.jsx)("strong",{children:n})]}),"more-results")]}return this.state.isLoading?Object(g.jsx)(d.b,{size:"l"}):null}showResults(e,t){return!(!e||!t||0===t.length)&&!(0===this.state.items.length&&!this.state.isLoading)}render(){const{items:e,query:t}=this.state,{input:s}=this.props;return Object(g.jsx)(n.default,{itemToString:e=>e?e.name:t,initialInputValue:t,initialIsOpen:Boolean(t),onInputValueChange:this.handleInputValueChange,onStateChange:({highlightedIndex:e,inputValue:t})=>{this.state.hasUserTyped?this.setState(s=>Object(i.a)(Object(i.a)({},s),{},{highlightedIndex:e,query:t||s.query})):this.setState(s=>Object(i.a)(Object(i.a)({},s),{},{highlightedIndex:e,query:t||s.query,hasUserTyped:!0}))},children:({getInputProps:t,getItemProps:n,highlightedIndex:r,inputValue:a,isOpen:l})=>{const c=t({id:"header-search-action"}),d=c.onKeyDown;return c.onKeyDown=e=>{d(e),this.handleInputKeyDown(e)},Object(g.jsxs)("div",Object(i.a)(Object(i.a)({},O()),{},{children:[Object(h.cloneElement)(s,c),this.showResults(l,a)&&Object(g.jsx)("div",Object(i.a)(Object(i.a)({},O("results")),{},{children:Object(g.jsxs)("div",Object(i.a)(Object(i.a)({},O("list")),{},{children:[this.getListHeader(),e.map((e,t)=>Object(g.jsx)("div",{onClick:()=>window.location.assign(e.url),children:Object(g.jsx)("a",Object(i.a)(Object(i.a)(Object(i.a)({},n({item:e})),O({element:"list-item",extra:t===r?"is-highlighted":""})),{},{children:Object(g.jsxs)(u.PersonListItem,{size:"s",children:[e.image?Object(g.jsx)(u.PersonListItem.Image,{alt:e.name,imageUrl:e.image}):null,Object(g.jsx)(u.PersonListItem.Fullname,{children:e.name}),e.institution?Object(g.jsx)(u.PersonListItem.MetaItems,{children:Object(g.jsx)(u.PersonListItem.MetaItem,{children:e.institution})}):null]})}))},e.id)),this.getListFooter()]}))}))]}))}})}}p.displayName="SearchAction",t.default=p},6647:function(e,t,s){}}]);